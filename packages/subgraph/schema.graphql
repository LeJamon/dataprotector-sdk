# ============================== Protected Data ==============================

type SchemaEntry @entity {
  id: String!
  path: String
  type: String
}

type ProtectedData @entity {
  id: Bytes!
  jsonSchema: String!
  schema: [SchemaEntry!]!
  owner: Account!
  name: String!
  collection: Collection
  multiaddr: Bytes!
  checksum: Bytes!
  creationTimestamp: BigInt!
  transactionHash: Bytes!
  blockNumber: BigInt!
}

type Account @entity {
  id: ID!
  datasets: [ProtectedData!]! @derivedFrom(field: "owner")
}

type Collection @entity {
  id: ID!
  owner: Bytes!
  protectedDatas: [ProtectedData!] @derivedFrom(field: "collection")
  subscriptions: [CollectionSubscription!] @derivedFrom(field: "collection")
  subscriptionsParams: SubscriptionsParams
  creationTimestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type SubscriptionsParams @entity {
  id: Bytes!
  duration: BigInt!
  price: BigInt!
}

# Cannot use 'Subscription' as it is a reserved word
type CollectionSubscription @entity {
  id: ID!
  collection: Collection
  protectedData: ProtectedData
  owner: Account!
  endDate: BigInt!
  creationTimestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}

type DealId @entity(immutable: true) {
  id: Bytes!
  creationTimestamp: BigInt!
  blockNumber: BigInt!
  transactionHash: Bytes!
}
