specVersion: 0.0.5
description: Subgraph for dataProtector smart contract
schema:
  file: ./schema.graphql
dataSources:
  # ============================= Data protector ==============================
  - name: DataProtector
    kind: ethereum/contract
    network: bellecour
    source:
      address: "0x3a4Ab33F3D605e75b6D00A32A0Fa55C3628F6A59"
      abi: DataProtector
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ProtectedData
        - SchemaEntry
      abis:
        - name: DataProtector
          file: ./abis/DataProtector.json
      eventHandlers:
        - event: DatasetSchema(indexed address,string)
          handler: handleDatasetSchema
      file: ./src/dataProtector.ts

  # ============================= Dataset registry ==============================
  - name: DatasetRegistry
    kind: ethereum/contract
    network: bellecour
    source:
      address: "0x799DAa22654128d0C64d5b79eac9283008158730"
      abi: DatasetRegistry
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ProtectedData
      abis:
        - name: Dataset
          file: node_modules/@iexec/poco/build/contracts/Dataset.json
        - name: DatasetRegistry
          file: node_modules/@iexec/poco/build/contracts/DatasetRegistry.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransferDataset
      file: ./src/datasetRegistry.ts

  # ============================= Collection ==============================
  - name: Collection
    kind: ethereum/contract
    network: bellecour
    source:
      address: "0x2f3722eC94c9B0fA617e87aBa77deF0fE88861a5"
      abi: Collection
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Collection
      abis:
        - name: Collection
          file: ./abis/Collection.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleTransfer
        - event: AddProtectedDataToCollection(uint256,address)
          handler: handleAddProtectedDataToCollection
        - event: RemoveProtectedDataFromCollection(uint256,address)
          handler: handleRemoveProtectedDataFromCollection
      file: ./src/collection.ts

  # ============================= ProtectedDataSharing ==============================
  - name: ProtectedDataSharing
    kind: ethereum/contract
    network: bellecour
    source:
      address: "0xC7bdd37e598C03e585800b2644807442efa9736D"
      abi: ProtectedDataSharing
      #START_BLOCK_PLACEHOLDER#
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - CollectionSubscription
      abis:
        - name: ProtectedDataSharing
          file: ./abis/ProtectedDataSharing.json
      eventHandlers:
        - event: NewSubscription(uint256,indexed address,uint48)
          handler: handleNewSubscription
        - event: NewSubscriptionParams(uint256,(uint112,uint48))
          handler: handleNewSubscriptionParams
        - event: AddProtectedDataForSubscription(uint256,address)
          handler: handleAddProtectedDataForSubscription
      file: ./src/collectionSubscription.ts
